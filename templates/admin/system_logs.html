{% extends 'layouts/_base.html' %}

{% block title %}Logs del Sistema - ThinkIt Academy{% endblock %}

{% block page_title %}Logs del Sistema{% endblock %}

{% block dashboard_content %}

<!-- Filtros -->
<div class="bg-white rounded-lg shadow mb-6">
    <div class="p-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">Filtros</h3>
    </div>
    <div class="p-4">
        <form method="GET" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
                <label for="user_type" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Usuario</label>
                <select class="w-full border border-gray-300 rounded-md px-3 py-2" id="user_type" name="user_type">
                    <option value="">Todos</option>
                    <option value="admin" {% if user_type_filter == 'admin' %}selected{% endif %}>Administrador</option>
                    <option value="teacher" {% if user_type_filter == 'teacher' %}selected{% endif %}>Profesor</option>
                    <option value="student" {% if user_type_filter == 'student' %}selected{% endif %}>Estudiante</option>
                    <option value="Anonymous" {% if user_type_filter == 'Anonymous' %}selected{% endif %}>Anónimo</option>
                </select>
            </div>
            <div>
                <label for="action" class="block text-sm font-medium text-gray-700 mb-1">Acción</label>
                <select class="w-full border border-gray-300 rounded-md px-3 py-2" id="action" name="action">
                    <option value="">Todas</option>
                    <option value="LOGIN" {% if action_filter == 'LOGIN' %}selected{% endif %}>Inicio de Sesión</option>
                    <option value="LOGOUT" {% if action_filter == 'LOGOUT' %}selected{% endif %}>Cierre de Sesión</option>
                    <option value="CREATE" {% if action_filter == 'CREATE' %}selected{% endif %}>Crear</option>
                    <option value="UPDATE" {% if action_filter == 'UPDATE' %}selected{% endif %}>Actualizar</option>
                    <option value="DELETE" {% if action_filter == 'DELETE' %}selected{% endif %}>Eliminar</option>
                    <option value="VIEW" {% if action_filter == 'VIEW' %}selected{% endif %}>Ver</option>
                </select>
            </div>
            <div class="flex items-end space-x-2">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Filtrar</button>
                <a href="{% url 'system_logs' %}" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">Limpiar</a>
            </div>
        </form>
    </div>
</div>

<!-- Tabla de Logs -->
<div class="bg-white rounded-lg shadow">
    <div class="p-4 border-b">
        <h3 class="text-lg font-semibold text-gray-900">Actividad del Sistema (Últimos 100 registros)</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha/Hora</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usuario</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acción</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for log in logs %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900">{{ log.timestamp|date:"d/m/Y H:i:s" }}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">{{ log.user_name }}</td>
                    <td class="px-4 py-3">
                        {% if log.user_type == 'admin' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Admin</span>
                        {% elif log.user_type == 'teacher' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">Profesor</span>
                        {% elif log.user_type == 'student' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Estudiante</span>
                        {% else %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ log.user_type }}</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3">
                        {% if log.action == 'LOGIN' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ log.action }}</span>
                        {% elif log.action == 'LOGOUT' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ log.action }}</span>
                        {% elif log.action == 'CREATE' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ log.action }}</span>
                        {% elif log.action == 'UPDATE' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ log.action }}</span>
                        {% elif log.action == 'DELETE' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ log.action }}</span>
                        {% elif log.action == 'VIEW' %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800">{{ log.action }}</span>
                        {% else %}
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ log.action }}</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900">{{ log.description }}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">{{ log.ip_address }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="px-4 py-8 text-center text-gray-500">No hay logs disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}